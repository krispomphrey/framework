<?php
/**
 * The MySQL driver for the framework.
 * Class defines database and holds useful functions.
 *
 * @package: Framework
 * @author: Kris Pomphrey <kris@krispomphrey.co.uk>
 */
class mysql{
  private $config;
  public $error;
  public $info;
  public $insert_id;
  public $db;

  /**
   * Implements __construct();
   *
   * The main Database constructor.
   */
  public function __construct($db_name, $credentials){
    $this->db = $db_name;
    $this->config = $credentials;
  }

  /**
   * Implements init();
   *
   * Initialise the connection using the details provided in conf.
   */
  public function init(){
    $con = mysql_connect($this->config['host'], $this->config['username'], $this->config['password']);
    $this->info = mysql_info();
    $this->error = mysql_error();

    if(!$con) $this->error();
    else mysql_select_db($this->db) or die(mysql_error());
  }

  /**
   * Implements query();
   *
   * Knowledge is power.  Have some.
   */
  public function query($statement){
    $results_objects = array();
    $results = mysql_query($statement);
    while($row = mysql_fetch_object($results)){
      $results_objects[] = $row;
    }
    $this->info = mysql_info();
    $this->error = mysql_error();
    return $results_objects;
  }

  /**
   * Implements select();
   *
   * Knowledge is power.  Have some.
   */
  public function select($statement){
    return $this->query($statement);
  }

  /**
   * Implements update();
   *
   * Level up!
   */
  public function update($statement){
    $this->query($statement);
    $this->insert_id = mysql_insert_id();
    if(mysql_affected_rows() >= 0){
      return true;
    } else {
      return false;
    }
  }

  /**
   * Implements delete();
   *
   * Content can no longer be allowed to exist.
   */
  public function delete($statement){
    $this->query($statement);
    $this->info = mysql_info();
    $this->error = mysql_error();
    if(mysql_affected_rows() >= 0){
      return true;
    } else {
      return false;
    }
  }

  /**
   * Implements destroy();
   *
   * You can kill a connection.  You can't kill an idea.
   */
  public function destroy(){
    $con = mysql_connect($this->config['host'], $this->config['username'], $this->config['password']);
    if(!$con) $this->error();
    else mysql_close($con);
  }

  /**
   * Implements error();
   *
   * What to do when we fail in our quest for content.
   */
  private function error(){
    if(file_exists(LAYOUT_ROOT.'error.php')){
      die(include_once(LAYOUT_ROOT.'error.php'));
    } else{
      die(include_once(FW_ROOT.'static/error.php'));
    }
  }
} ?>

